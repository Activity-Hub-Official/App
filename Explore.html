<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Activity Hub</title>
  <link rel="icon" href="https://i.imgur.com/EsNcDyR.png" />

  <!-- TailwindCSS with class-based dark mode -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />

  <!-- QRCode Library (used when generating dynamic QR codes) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100">

  <!-- ========== NAVBAR ========== -->
  <header class="fixed top-0 left-0 right-0 h-16 bg-white dark:bg-gray-800 shadow flex items-center px-4 z-50">
    <button id="toggleBtn" class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white mr-4" aria-label="Toggle sidebar">
      <i class="fas fa-bars fa-lg"></i>
    </button>
    <a data-key="Explore" href="#" class="flex items-center">
      <img src="https://i.imgur.com/T28QHq2.png" alt="Activity Hub Logo" class="h-12 w-auto"/>
      <span class="ml-2 text-xl font-bold">Activity Hub</span>
    </a>
    <div id="authContainer" class="ml-auto flex items-center space-x-4">
      <button id="signInBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Sign In / Up</button>
    </div>
  </header>

  <div class="flex pt-16">
    <!-- ========== SIDEBAR ========== -->
    <aside id="sidebar"
           class="fixed top-16 bottom-0 left-0 bg-white dark:bg-gray-800 shadow-lg w-48 transform -translate-x-full md:translate-x-0 transition-transform duration-300 overflow-hidden z-40"
           aria-label="Main sidebar navigation">
      <nav class="mt-4 px-2">
        <ul class="space-y-2">
          <li>
            <a data-key="Explore" href="#"
               class="flex items-center gap-3 p-2 rounded font-semibold bg-gray-200 dark:bg-gray-700">
              <i class="fas fa-compass w-6 text-center"></i><span>Explore</span>
            </a>
          </li>
          <li><hr class="border-gray-300 dark:border-gray-600 my-2"></li>
          <li>
            <a data-key="Clubs" href="#"
               class="flex items-center gap-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded font-semibold">
              <i class="fas fa-users w-6"></i><span>Clubs</span>
            </a>
          </li>
          <li>
            <a data-key="Businesses" href="#"
               class="flex items-center gap-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded font-semibold">
              <i class="fas fa-briefcase w-6"></i><span>Businesses</span>
            </a>
          </li>
          <li>
            <a data-key="Projects" href="#"
               class="flex items-center gap-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded font-semibold">
              <i class="fas fa-project-diagram w-6"></i><span>Projects</span>
            </a>
          </li>
          <li>
            <a data-key="People" href="#"
               class="flex items-center gap-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded font-semibold">
              <i class="fas fa-user-friends w-6"></i><span>People</span>
            </a>
          </li>
          <li>
            <a data-key="Events" href="#"
               class="flex items-center gap-3 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded font-semibold">
              <i class="fas fa-calendar-alt w-6"></i><span>Events</span>
            </a>
          </li>
        </ul>
      </nav>
      <!-- Dark mode toggle -->
      <div class="absolute bottom-4 w-full px-4 flex items-center">
        <i id="darkIcon" class="fas fa-moon text-gray-600 dark:text-gray-300 cursor-pointer" aria-label="Toggle dark mode"></i>
        <span id="darkToggleText" class="ml-2 text-sm font-bold">Dark Mode</span>
        <label id="darkToggleLabel" for="darkToggle" class="ml-auto relative inline-block w-10 h-6 cursor-pointer">
          <input id="darkToggle" type="checkbox" class="sr-only peer"/>
          <div class="w-10 h-6 bg-gray-300 rounded-full peer-checked:bg-blue-600 transition-colors"></div>
          <div class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full peer-checked:translate-x-4 transition-transform"></div>
        </label>
      </div>
    </aside>

    <!-- ========== MAIN CONTAINER ========== -->
    <div id="main" role="main" class="flex-1 transition-all duration-300 ml-0 md:ml-48">
      <main id="content" class="max-w-7xl mx-auto px-4 py-6">
        <h1 class="text-3xl font-semibold mb-6">Explore</h1>
        <!-- Skeletons or Cards injected by JavaScript -->
      </main>
    </div>
  </div>

  <!-- ========== SECTION TEMPLATE (used to group cards) ========== -->
  <template id="section-template">
    <section class="mb-12">
      <h2 class="text-2xl font-semibold mb-6"></h2>
      <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3"></div>
    </section>
  </template>

  <!-- ========== CARD TEMPLATE ========== -->
  <template id="card-template">
    <div class="card bg-white dark:bg-gray-800 rounded-2xl shadow hover:shadow-lg dark:hover:shadow-xl transition p-4 flex flex-col cursor-pointer">
      <div class="flex items-center mb-2">
        <img class="h-8 w-8 object-cover rounded-full mr-2 border-2 border-gray-200 dark:border-gray-700"
             src="" alt="Logo"/>
        <h3 class="text-lg font-semibold flex-1"></h3>
      </div>
      <p class="text-sm text-gray-600 dark:text-gray-300 mb-4 line-clamp-2 tagline"></p>
      <div class="flex flex-wrap gap-2 mb-4">
        <span class="business-type bg-teal-100 dark:bg-teal-900 text-teal-800 dark:text-teal-200 text-xs font-medium px-2.5 py-0.5 rounded-full"></span>
        <span class="industry bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs font-medium px-2.5 py-0.5 rounded-full"></span>
        <span class="stage bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs font-medium px-2.5 py-0.5 rounded-full"></span>
      </div>
      <div class="flex items-center text-xs text-gray-500 dark:text-gray-400 mt-auto">
        <i class="fas fa-map-marker-alt mr-1"></i><span class="school mr-4"></span>
        <i class="fas fa-circle text-green-500 dark:text-green-400 text-[0.5rem] mr-1"></i><span class="members mr-1"></span> Members
      </div>
    </div>
  </template>

  <!-- ========== SKELETON-CARD TEMPLATE (animated placeholder) ========== -->
  <template id="skeleton-card-template">
    <div class="animate-pulse bg-white dark:bg-gray-800 rounded-2xl shadow p-4 flex flex-col">
      <div class="flex items-center mb-2">
        <div class="h-8 w-8 bg-gray-300 dark:bg-gray-700 rounded-full mr-2"></div>
        <div class="h-5 bg-gray-300 dark:bg-gray-700 rounded w-3/4"></div>
      </div>
      <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded mb-4 w-full"></div>
      <div class="flex gap-2 mb-4">
        <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded-full w-16"></div>
        <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded-full w-12"></div>
        <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded-full w-10"></div>
      </div>
      <div class="flex items-center text-xs text-gray-500 dark:text-gray-400 mt-auto">
        <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-1/3 mr-4"></div>
        <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-1/4"></div>
      </div>
    </div>
  </template>

  <!-- ========== DETAILS/PROFILE PAGE TEMPLATE ========== -->
  <template id="details-page-template">
    <div class="max-w-3xl mx-auto px-4 py-6 space-y-6">
      <!-- Back to Explore Link -->
      <button id="backBtn" class="flex items-center text-blue-500 hover:underline">
        <i class="fas fa-arrow-left mr-2"></i>Back to Explore
      </button>

      <!-- Header Panel with Logo, Title, Verify Icon, University, Members, Join Button -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 space-y-4">
        <div class="flex items-start space-x-4">
          <!-- Logo (circular) + verify check badge -->
          <div class="relative">
            <img class="h-24 w-24 object-cover rounded-full border-2 border-gray-200 dark:border-gray-700 details-logo"
                 src="" alt="Logo">
            <div class="absolute bottom-0 right-0 bg-blue-600 rounded-full w-6 h-6 flex items-center justify-center">
              <i class="fas fa-check text-white text-xs"></i>
            </div>
          </div>

          <div class="flex-1 space-y-1">
            <!-- Title + (verify icon already shown above) -->
            <div class="flex items-center space-x-2">
              <h1 class="text-3xl font-bold details-title"></h1>
            </div>
            <!-- Subtitle: University Â· Members Count -->
            <p class="text-gray-600 dark:text-gray-400 mt-1">
              <span class="details-school font-medium"></span> &middot; 
              <span class="details-members font-medium"></span> Members
            </p>

            <!-- Visit Links as Icons (up to 4) and "+N" button -->
            <div id="visit-icons-container" class="flex items-center space-x-3 mt-3">
              <!-- JavaScript will insert up to four colored icons, then a "+N" button if needed -->
            </div>
          </div>

          <!-- Share / Flag / Join -->
          <div class="flex items-center space-x-3">
            <button id="page-share-btn" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="fas fa-share-alt text-2xl text-gray-600 dark:text-gray-300"></i>
            </button>
            <a id="page-flag-btn" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <i class="fas fa-flag text-2xl text-red-500"></i>
            </a>
            <!-- Join button always shown -->
            <a id="page-join-btn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-center">
              Join
            </a>
          </div>
        </div>

        <!-- Divider -->
        <hr class="border-gray-200 dark:border-gray-700">

        <!-- Tags Row (Industry first, then Business Type, then Stage) -->
        <div class="flex flex-wrap gap-3">
          <!-- Industry as the first tag -->
          <span class="details-industry bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs font-medium px-3 py-1 rounded-full"></span>
          <span class="details-businesstype bg-teal-100 dark:bg-teal-900 text-teal-800 dark:text-teal-200 text-xs font-semibold px-3 py-1 rounded-full"></span>
          <span class="details-stage bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs font-semibold px-3 py-1 rounded-full"></span>
        </div>

        <!-- Tab Navigation with icons -->
        <nav class="flex space-x-6 border-b border-gray-200 dark:border-gray-700 pb-2">
          <button type="button" class="tab-button text-blue-600 dark:text-blue-400 font-medium pb-1" data-tab="overview">
            <i class="fas fa-info-circle mr-1"></i>Overview
          </button>
          <button type="button" class="tab-button text-gray-500 dark:text-gray-400 font-medium pb-1" data-tab="events">
            <i class="fas fa-calendar-alt mr-1"></i>Events
          </button>
          <button type="button" class="tab-button text-gray-500 dark:text-gray-400 font-medium pb-1" data-tab="contact">
            <i class="fas fa-envelope mr-1"></i>Contact Info
          </button>
        </nav>
      </div>

      <!-- ========== Tab Content: Overview ========== -->
      <div id="overview" class="tab-content bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mt-4 space-y-6">
        <!-- About Us -->
        <div>
          <h2 class="text-xl font-semibold mb-2">About Us</h2>
          <p class="text-gray-700 dark:text-gray-300 details-desc"></p>
        </div>

        <!-- Upcoming Events -->
        <div>
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-xl font-semibold">Upcoming Events</h2>
            <a href="#" id="view-all-events" class="text-blue-500 hover:underline text-sm font-medium">View all</a>
          </div>
          <div class="border border-gray-300 dark:border-gray-700 rounded-lg h-40 flex justify-center items-center">
            <span class="text-gray-500 dark:text-gray-400">
              No events right now, but check back laterâsomething exciting might be coming!
            </span>
          </div>
        </div>

        <!-- Comments -->
        <div>
          <h2 class="text-xl font-semibold mb-2">Comments</h2>
          <textarea
            disabled
            title="Feature coming soon"
            placeholder="Feature coming soon"
            class="w-full h-20 bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 resize-none cursor-not-allowed"
          ></textarea>
        </div>
      </div>

      <!-- ========== Tab Content: Events ========== -->
      <div id="events" class="tab-content hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mt-4 text-gray-700 dark:text-gray-300">
        <p>No events yet.</p>
      </div>

      <!-- ========== Tab Content: Contact Info ========== -->
      <div id="contact" class="tab-content hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mt-4 text-gray-700 dark:text-gray-300 space-y-3">
        <p><strong>Email:</strong> <a href="#" class="details-contact-email text-blue-600 dark:text-blue-400 hover:underline"></a></p>
        <p><strong>Form:</strong> <a href="#" class="details-contact-form text-blue-600 dark:text-blue-400 hover:underline" target="_blank"></a></p>
      </div>
    </div>
  </template>

  <!-- ========== SHARE MODAL TEMPLATE ========== -->
  <template id="share-modal-template">
    <div class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog">
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-6 relative">
        <button type="button" class="absolute top-3 right-3 text-2xl text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white close-share-modal">&times;</button>
        <h3 class="text-xl font-semibold mb-4">Share</h3>
        <div class="grid grid-cols-4 gap-6 justify-items-center">
          <!-- Copy Link -->
          <div class="relative group cursor-pointer p-2" data-share="copy" title="Copy Link">
            <div class="absolute inset-0 bg-gray-100 dark:bg-gray-700 opacity-50 rounded-xl hidden group-hover:block"></div>
            <div class="relative flex flex-col items-center">
              <div class="w-16 h-16 flex items-center justify-center rounded-full bg-blue-600 hover:bg-blue-700 transition-shadow shadow-md">
                <i class="fas fa-link fa-2x text-white"></i>
              </div>
              <span class="mt-2 text-sm font-medium">Copy Link</span>
            </div>
          </div>
          <!-- QR Code -->
          <div class="relative group cursor-pointer p-2" data-share="qr" title="QR Code">
            <div class="absolute inset-0 bg-gray-100 dark:bg-gray-700 opacity-50 rounded-xl hidden group-hover:block"></div>
            <div class="relative flex flex-col items-center">
              <div class="w-16 h-16 rounded-full overflow-hidden shadow-md">
                <img src="https://i.imgur.com/nWDcvp1.png" alt="QR Code" class="w-full h-full object-cover qr-img"/>
              </div>
              <span class="mt-2 text-sm font-medium">QR Code</span>
            </div>
          </div>
          <!-- WhatsApp -->
          <div class="relative group cursor-pointer p-2" data-share="whatsapp" title="WhatsApp">
            <div class="absolute inset-0 bg-gray-100 dark:bg-gray-700 opacity-50 rounded-xl hidden group-hover:block"></div>
            <div class="relative flex flex-col items-center">
              <div class="w-16 h-16 rounded-full overflow-hidden shadow-md">
                <img src="https://i.imgur.com/qOttODu.png" alt="WhatsApp" class="w-full h-full object-cover"/>
              </div>
              <span class="mt-2 text-sm font-medium">WhatsApp</span>
            </div>
          </div>
          <!-- Telegram -->
          <div class="relative group cursor-pointer p-2" data-share="telegram" title="Telegram">
            <div class="absolute inset-0 bg-gray-100 dark:bg-gray-700 opacity-50 rounded-xl hidden group-hover:block"></div>
            <div class="relative flex flex-col items-center">
              <div class="w-16 h-16 rounded-full overflow-hidden shadow-md">
                <img src="https://i.imgur.com/uU1H4xZ.png" alt="Telegram" class="w-full h-full object-cover"/>
              </div>
              <span class="mt-2 text-sm font-medium">Telegram</span>
            </div>
          </div>
          <!-- Reddit -->
          <div class="relative group cursor-pointer p-2" data-share="reddit" title="Reddit">
            <div class="absolute inset-0 bg-gray-100 dark:bg-gray-700 opacity-50 rounded-xl hidden group-hover:block"></div>
            <div class="relative flex flex-col items-center">
              <div class="w-16 h-16 rounded-full overflow-hidden shadow-md">
                <img src="https://i.imgur.com/zELebxD.png" alt="Reddit" class="w-full h-full object-cover"/>
              </div>
              <span class="mt-2 text-sm font-medium">Reddit</span>
            </div>
          </div>
          <!-- LinkedIn -->
          <div class="relative group cursor-pointer p-2" data-share="linkedin" title="LinkedIn">
            <div class="absolute inset-0 bg-gray-100 dark:bg-gray-700 opacity-50 rounded-xl hidden group-hover:block"></div>
            <div class="relative flex flex-col items-center">
              <div class="w-16 h-16 rounded-full overflow-hidden shadow-md">
                <img src="https://i.imgur.com/PEw6T9z.png" alt="LinkedIn" class="w-full h-full object-cover"/>
              </div>
              <span class="mt-2 text-sm font-medium">LinkedIn</span>
            </div>
          </div>
          <!-- X (formerly Twitter) -->
          <div class="relative group cursor-pointer p-2" data-share="twitter" title="X">
            <div class="absolute inset-0 bg-gray-100 dark:bg-gray-700 opacity-50 rounded-xl hidden group-hover:block"></div>
            <div class="relative flex flex-col items-center">
              <div class="w-16 h-16 rounded-full overflow-hidden shadow-md">
                <img src="https://i.imgur.com/PLQsGra.png" alt="X" class="w-full h-full object-cover"/>
              </div>
              <span class="mt-2 text-sm font-medium">X</span>
            </div>
          </div>
          <!-- Email -->
          <div class="relative group cursor-pointer p-2" data-share="email" title="Email">
            <div class="absolute inset-0 bg-gray-100 dark:bg-gray-700 opacity-50 rounded-xl hidden group-hover:block"></div>
            <div class="relative flex flex-col items-center">
              <div class="w-16 h-16 rounded-full overflow-hidden shadow-md">
                <img src="https://i.imgur.com/cBOGtrb.png" alt="Email" class="w-full h-full object-cover"/>
              </div>
              <span class="mt-2 text-sm font-medium">Email</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </template>

  <!-- ========== VISIT-LINKS MODAL TEMPLATE ========== -->
  <div id="visitLinksModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-lg w-full p-6 relative">
      <button id="close-visit-modal" class="absolute top-3 right-3 text-2xl text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white">&times;</button>
      <h3 class="text-xl font-semibold mb-4">All Project Links</h3>
      <div id="visit-links-list" class="space-y-2">
        <!-- JavaScript will populate this list with all links -->
      </div>
    </div>
  </div>

  <!-- ========== JAVASCRIPT (placed at the END so all templates/elements exist first) ========== -->
  <script>
    // âââââââ Constants & Globals âââââââ
    const LINK_API = 'https://sheet2api.com/v1/rhBSJNTTYKgC/hyperlinks';
    const API      = 'https://sheet2api.com/v1/an4oVvpQR51V/mock-data-new';
    const AUTH_API = 'https://sheet2api.com/v1/rkmbUqHQAC3C/submission-form-responses';
    let linkMap   = {};
    let itemMap   = {};

    // Utility: turn a title into a slug (lowercase, hyphens, no leading/trailing hyphens)
    function generateSlug(text) {
      return text
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
    }

    // Update the browser URL hash without reloading
    function updateHistory(slug) {
      if (history.pushState) {
        history.pushState({slug}, '', `#${slug}`);
      }
    }

    // âââââââ Render skeleton placeholders âââââââ
    function renderSkeletons() {
      const content = document.getElementById('content');
      content.innerHTML = '<h1 class="text-3xl font-semibold mb-6">Explore</h1>';
      const skeletonContainer = document.createElement('div');
      skeletonContainer.className = 'grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3';
      // Show 6 skeleton cards
      for (let i = 0; i < 6; i++) {
        const skel = document.getElementById('skeleton-card-template').content.cloneNode(true);
        skeletonContainer.append(skel);
      }
      content.append(skeletonContainer);
    }

    // âââââââ Render the âExploreâ Grid of Cards âââââââ
    function renderListings() {
      const content = document.getElementById('content');
      // Clear out anything inside #content
      content.innerHTML = '<h1 class="text-3xl font-semibold mb-6">Explore</h1>';

      // We expect itemMap to already be populated (slug â itemObject)
      // We group by âProject Typeâ (Clubs & Orgs, Business, Other Projects)
      const titles = {
        'Clubs & Orgs': 'Clubs',
        'Business':     'Businesses',
        'Other Projects':'Projects'
      };

      Object.entries(titles).forEach(([ptype, heading]) => {
        // Clone the section template
        const sec = document.getElementById('section-template').content.cloneNode(true);
        sec.querySelector('h2').textContent = heading;

        const grid = sec.querySelector('div'); // the <div class="grid â¦">

        // Filter items by project type
        Object.values(itemMap)
          .filter(i => i["Project Type"] === ptype)
          .forEach(item => {
            const slug = generateSlug(item["Project Title"]);
            const card = document.getElementById('card-template').content.cloneNode(true);

            // Populate the card fields
            card.querySelector('img').src = item["Logo URL"];
            card.querySelector('h3').textContent = item["Project Title"];
            card.querySelector('.tagline').textContent = item.Tagline;

            const bt = card.querySelector('.business-type');
            if (ptype === 'Business' && item["Business Type"]) {
              bt.textContent = item["Business Type"];
            } else {
              bt.remove();
            }

            card.querySelector('.industry').textContent = item.Industry;

            const st = card.querySelector('.stage');
            if (item.Stage) {
              st.textContent = item.Stage;
            } else {
              st.remove();
            }

            card.querySelector('.school').textContent  = item["College or University Name"];
            card.querySelector('.members').textContent = item["Number of participants"];

            const cardEl = card.querySelector('.card');
            cardEl.setAttribute('data-slug', slug);
            cardEl.addEventListener('click', () => showDetails(item, slug));
            grid.append(card);
          });

        content.append(sec);
      });
    }

    // âââââââ Show the âProfile Pageâ for a single item âââââââ
    function showDetails(item, slug) {
      updateHistory(slug);

      // Grab the <div id="main"> so we can replace its contents
      const main = document.getElementById('main');

      // Clone the profile template
      const detailTpl = document.getElementById('details-page-template').content.cloneNode(true);

      // 1) Fill in the Logo, Title, University, Members, Tagline, Description
      const logoEl = detailTpl.querySelector('.details-logo');
      if (logoEl) logoEl.src = item["Logo URL"];

      const titleEl = detailTpl.querySelector('.details-title');
      if (titleEl) titleEl.textContent = item["Project Title"];

      const schoolEl = detailTpl.querySelector('.details-school');
      if (schoolEl) schoolEl.textContent = item["College or University Name"];

      const membersEl = detailTpl.querySelector('.details-members');
      if (membersEl) membersEl.textContent = item["Number of participants"];

      const descEl = detailTpl.querySelector('.details-desc');
      if (descEl) descEl.textContent = item.Description;

      // 2) âIndustryâ & âBusiness Typeâ & âStageâ tags
      const industryTag = detailTpl.querySelector('.details-industry');
      if (industryTag) industryTag.textContent = item.Industry;

      const btTag = detailTpl.querySelector('.details-businesstype');
      if (btTag) {
        if (item["Business Type"]) {
          btTag.textContent = item["Business Type"];
        } else {
          btTag.remove();
        }
      }

      const stageTag = detailTpl.querySelector('.details-stage');
      if (stageTag) {
        if (item.Stage) {
          stageTag.textContent = item.Stage;
        } else {
          stageTag.remove();
        }
      }

      // 3) Visit Links: populate up to four colored icons, then "+N" if needed
      const visitMap = {
        website:   item.Website,
        instagram: item.Instagram,
        linkedin:  item.LinkedIn,
        youtube:   item.YouTube,
        tiktok:    item.TikTok,
        github:    item.GitHub,
        discord:   item.Discord,
        twitter:   item.Twitter,
        linktree:  item.LinkTree
      };
      // Build an array of existing links
      const visitEntries = Object.entries(visitMap).filter(([_, url]) => url);
      const visitIconsContainer = detailTpl.querySelector('#visit-icons-container');

      if (visitIconsContainer) {
        visitEntries.slice(0, 4).forEach(([key, url]) => {
          const a = document.createElement('a');
          a.href = url;
          a.target = '_blank';
          let iconHTML = '';
          if (key === 'website') {
            iconHTML = '<i class="fa-solid fa-globe fa-lg text-gray-800 dark:text-gray-200"></i>';
          } else {
            switch(key) {
              case 'instagram':
                iconHTML = '<i class="fa-brands fa-instagram fa-lg text-pink-500"></i>';
                break;
              case 'linkedin':
                iconHTML = '<i class="fa-brands fa-linkedin fa-lg text-blue-700"></i>';
                break;
              case 'youtube':
                iconHTML = '<i class="fa-brands fa-youtube fa-lg text-red-600"></i>';
                break;
              case 'tiktok':
                iconHTML = '<i class="fa-brands fa-tiktok fa-lg text-black"></i>';
                break;
              case 'github':
                iconHTML = '<i class="fa-brands fa-github fa-lg text-black"></i>';
                break;
              case 'discord':
                iconHTML = '<i class="fa-brands fa-discord fa-lg text-indigo-500"></i>';
                break;
              case 'twitter':
                iconHTML = '<i class="fa-brands fa-twitter fa-lg text-blue-400"></i>';
                break;
              case 'linktree':
                iconHTML = '<i class="fa-solid fa-link fa-lg text-green-500"></i>';
                break;
              default:
                iconHTML = '<i class="fa-solid fa-link fa-lg text-gray-800 dark:text-gray-200"></i>';
                break;
            }
          }
          a.className = 'hover:opacity-80';
          a.innerHTML = iconHTML;
          visitIconsContainer.append(a);
        });

        if (visitEntries.length > 4) {
          const remaining = visitEntries.length - 4;
          const moreBtn = document.createElement('button');
          moreBtn.textContent = `+${remaining}`;
          moreBtn.className = 'text-gray-600 dark:text-gray-300 font-medium hover:text-gray-800 dark:hover:text-white';
          moreBtn.addEventListener('click', () => {
            openVisitLinksModal(visitEntries);
          });
          visitIconsContainer.append(moreBtn);
        }
      }

      // 4) Join button (always present)
      const joinBtn = detailTpl.querySelector('#page-join-btn');
      if (joinBtn) {
        if (item["Join Link"]) {
          joinBtn.href = item["Join Link"];
        } else {
          joinBtn.href = "#";
        }
      }

      // 5) Flag icon hyperlink via linkMap["Report"]
      const flagLink = detailTpl.querySelector('#page-flag-btn');
      if (flagLink) {
        if (linkMap["Report"]) {
          flagLink.href = linkMap["Report"];
        } else {
          flagLink.href = "#";
        }
      }

      // 6) âView allâ should switch to Events tab
      const viewAll = detailTpl.querySelector('#view-all-events');
      if (viewAll) {
        viewAll.addEventListener('click', e => {
          e.preventDefault();
          const eventsTab = main.querySelector('.tab-button[data-tab="events"]');
          if (eventsTab) eventsTab.click();
        });
      }

      // 7) Contact Info tab
      const emailEl = detailTpl.querySelector('.details-contact-email');
      if (emailEl) {
        if (item["Project Contact Email"]) {
          emailEl.href = `mailto:${item["Project Contact Email"]}`;
          emailEl.textContent = item["Project Contact Email"];
        } else {
          emailEl.parentElement.classList.add('hidden');
        }
      }
      const formEl = detailTpl.querySelector('.details-contact-form');
      if (formEl) {
        if (item["Contact Form"]) {
          formEl.href = item["Contact Form"];
          formEl.textContent = 'Open Form';
        } else {
          formEl.parentElement.classList.add('hidden');
        }
      }

      // 8) âBack to Exploreâ button
      const backBtn = detailTpl.querySelector('#backBtn');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          history.pushState({}, '', window.location.pathname);
          document.getElementById('main').innerHTML = '<main id="content" class="max-w-7xl mx-auto px-4 py-6"></main>';
          renderSkeletons();
          fetchAndRenderItems();
        });
      }

      // Finally, replace #mainâs contents with this profile fragment
      main.innerHTML = '';
      main.append(detailTpl);

      // 9) Wire up the Share modal to show on click, and make all share options functional
      const shareBtn = main.querySelector('#page-share-btn');
      if (shareBtn) {
        shareBtn.addEventListener('click', () => {
          // Clone the share modal template
          const fragment = document.getElementById('share-modal-template').content.cloneNode(true);
          document.body.append(fragment);

          // The newly appended overlay is the last .modal-overlay in the body
          const modalOverlay = document.querySelector('body > .modal-overlay:last-child');

          // Attach click listeners to each [data-share] element
          modalOverlay.querySelectorAll('[data-share]').forEach(el => {
            const type = el.getAttribute('data-share');
            el.addEventListener('click', () => {
              const url = window.location.href;
              switch(type) {
                case 'copy':
                  navigator.clipboard.writeText(url).then(() => {
                    alert('Link copied to clipboard');
                  });
                  break;
                case 'qr':
                  // Generate a QR code and replace the <img> inside this tile
                  const img = el.querySelector('.qr-img');
                  QRCode.toDataURL(url, { width: 128 }, (err, dataUrl) => {
                    if (!err && img) {
                      img.src = dataUrl;
                    }
                  });
                  break;
                case 'whatsapp':
                  window.open(`https://wa.me/?text=${encodeURIComponent(url)}`, '_blank');
                  break;
                case 'telegram':
                  window.open(`https://t.me/share/url?url=${encodeURIComponent(url)}`, '_blank');
                  break;
                case 'reddit':
                  window.open(`https://www.reddit.com/submit?url=${encodeURIComponent(url)}`, '_blank');
                  break;
                case 'linkedin':
                  window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`, '_blank');
                  break;
                case 'twitter':
                  window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}`, '_blank');
                  break;
                case 'email':
                  window.location.href = `mailto:?subject=${encodeURIComponent(document.title)}&body=${encodeURIComponent(url)}`;
                  break;
              }
            });
          });

          // Attach close handler
          modalOverlay.querySelectorAll('.close-share-modal').forEach(btn => {
            btn.addEventListener('click', () => modalOverlay.remove());
          });
        });
      }

      // Activate the first tab (Overview) by default
      const navButtons = main.querySelectorAll('.tab-button');
      navButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          navButtons.forEach(b => {
            b.classList.remove('text-blue-600','dark:text-blue-400');
            b.classList.add('text-gray-500','dark:text-gray-400');
          });
          btn.classList.remove('text-gray-500','dark:text-gray-400');
          btn.classList.add('text-blue-600','dark:text-blue-400');
          const tabId = btn.dataset.tab;
          main.querySelectorAll('.tab-content').forEach(panel => {
            panel.classList.add('hidden');
          });
          main.querySelector('#' + tabId).classList.remove('hidden');
        });
      });
      // Trigger âOverviewâ tab
      if (navButtons.length) navButtons[0].click();
    }

    // âââââââ Fetch items and render skeletons first âââââââ
    function fetchAndRenderItems() {
      renderSkeletons();
      fetch(API)
        .then(r => r.json())
        .then(items => {
          items.forEach(item => {
            const slug = generateSlug(item["Project Title"]);
            itemMap[slug] = item;
          });
          // If a hash is present in the URL, deep-link to that profile immediately:
          const initialSlug = location.hash.slice(1);
          if (initialSlug && itemMap[initialSlug]) {
            showDetails(itemMap[initialSlug], initialSlug);
          } else {
            renderListings();
          }
        })
        .catch(console.error);
    }

    // âââââââ Open the Visit Links Modal, showing all links âââââââ
    function openVisitLinksModal(entries) {
      const modal = document.getElementById('visitLinksModal');
      const listContainer = document.getElementById('visit-links-list');
      if (!modal || !listContainer) return;
      listContainer.innerHTML = '';

      entries.forEach(([key, url]) => {
        const div = document.createElement('div');
        div.className = 'flex items-center space-x-2';
        let iconHTML = '';
        if (key === 'website') {
          iconHTML = '<i class="fa-solid fa-globe fa-lg text-gray-800 dark:text-gray-200"></i>';
        } else {
          switch(key) {
            case 'instagram':
              iconHTML = '<i class="fa-brands fa-instagram fa-lg text-pink-500"></i>';
              break;
            case 'linkedin':
              iconHTML = '<i class="fa-brands fa-linkedin fa-lg text-blue-700"></i>';
              break;
            case 'youtube':
              iconHTML = '<i class="fa-brands fa-youtube fa-lg text-red-600"></i>';
              break;
            case 'tiktok':
              iconHTML = '<i class="fa-brands fa-tiktok fa-lg text-black"></i>';
              break;
            case 'github':
              iconHTML = '<i class="fa-brands fa-github fa-lg text-black"></i>';
              break;
            case 'discord':
              iconHTML = '<i class="fa-brands fa-discord fa-lg text-indigo-500"></i>';
              break;
            case 'twitter':
              iconHTML = '<i class="fa-brands fa-twitter fa-lg text-blue-400"></i>';
              break;
            case 'linktree':
              iconHTML = '<i class="fa-solid fa-link fa-lg text-green-500"></i>';
              break;
            default:
              iconHTML = '<i class="fa-solid fa-link fa-lg text-gray-800 dark:text-gray-200"></i>';
              break;
          }
        }
        div.innerHTML = `
          ${iconHTML}
          <a href="${url}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline break-all">${key.charAt(0).toUpperCase() + key.slice(1)}</a>
        `;
        listContainer.append(div);
      });

      modal.classList.remove('hidden');
      const closeBtn = document.getElementById('close-visit-modal');
      if (closeBtn) {
        closeBtn.onclick = () => {
          modal.classList.add('hidden');
        };
      }
    }

    // âââââââ DOMContentLoaded âââââââ
    document.addEventListener('DOMContentLoaded', () => {
      // 1) Theme Setup
      const htmlEl     = document.documentElement;
      const themeToggle = document.getElementById('darkToggle');
      const themeIcon   = document.getElementById('darkIcon');
      const storedTheme = localStorage.getItem('theme');
      if (themeToggle && themeIcon) {
        if (storedTheme === 'dark') {
          htmlEl.classList.add('dark');
          themeToggle.checked = true;
          themeIcon.classList.replace('fa-moon','fa-sun');
        } else {
          htmlEl.classList.remove('dark');
          themeToggle.checked = false;
          themeIcon.classList.replace('fa-sun','fa-moon');
        }

        // Dark mode toggle (icon + checkbox)
        themeToggle.addEventListener('change', e => {
          if (e.target.checked) {
            htmlEl.classList.add('dark');
            themeIcon.classList.replace('fa-moon','fa-sun');
            localStorage.setItem('theme','dark');
          } else {
            htmlEl.classList.remove('dark');
            themeIcon.classList.replace('fa-sun','fa-moon');
            localStorage.setItem('theme','light');
          }
        });
        themeIcon.addEventListener('click', () => {
          themeToggle.checked = !themeToggle.checked;
          themeToggle.dispatchEvent(new Event('change'));
        });
      }

      // 2) Load ânav linksâ from LINK_API and apply
      fetch(LINK_API)
        .then(r => r.json())
        .then(arr => {
          linkMap = arr[0];
          Object.entries(linkMap).forEach(([key, url]) => {
            document.querySelectorAll(`a[data-key="${key}"]`).forEach(a => a.href = url);
          });
        })
        .catch(console.error);

      // 3) Restore any logged-in session
      const stored = localStorage.getItem('currentUser');
      if (stored) {
        try {
          initAuth(JSON.parse(stored));
        } catch {
          localStorage.removeItem('currentUser');
        }
      }

      // 4) Fetch items and render skeletons first
      fetchAndRenderItems();

      // 5) Sidebar toggle (mobile vs. desktop)
      const toggleBtn = document.getElementById('toggleBtn');
      if (toggleBtn) {
        toggleBtn.addEventListener('click', () => {
          const sb       = document.getElementById('sidebar');
          const mn       = document.getElementById('main');
          const isMobile = window.innerWidth < 768;
          if (sb && mn) {
            if (isMobile) {
              const hidden = sb.classList.contains('-translate-x-full');
              sb.classList.toggle('translate-x-0', hidden);
              sb.classList.toggle('-translate-x-full', !hidden);
            } else {
              if (sb.classList.contains('w-48')) {
                sb.classList.replace('w-48','w-16');
                mn.classList.replace('md:ml-48','md:ml-16');
                document.querySelectorAll('#sidebar span').forEach(s => s.classList.add('hidden'));
                document.getElementById('darkToggleLabel')?.classList.add('hidden');
                document.getElementById('darkToggleText')?.classList.add('hidden');
              } else {
                sb.classList.replace('w-16','w-48');
                mn.classList.replace('md:ml-16','md:ml-48');
                document.querySelectorAll('#sidebar span').forEach(s => s.classList.remove('hidden'));
                document.getElementById('darkToggleLabel')?.classList.remove('hidden');
                document.getElementById('darkToggleText')?.classList.remove('hidden');
              }
            }
          }
        });
      }

      // 6) Sign-In modal logic
      const signInBtn = document.getElementById('signInBtn');
      if (signInBtn) {
        signInBtn.addEventListener('click', () => {
          const tpl = document.createElement('template');
          tpl.innerHTML = `
          <div class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog">
            <div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-lg w-80 p-6">
              <div id="signin-loading" class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 hidden">
                <div class="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
              </div>
              <button id="close-signin" class="absolute top-3 right-3 text-2xl text-gray-500 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white">&times;</button>
              <h3 class="text-xl font-semibold mb-4">Sign In</h3>
              <form id="signin-form" class="space-y-4">
                <div>
                  <label for="signin-email" class="block text-sm font-medium mb-1">Email</label>
                  <input id="signin-email" type="email" required class="w-full px-3 py-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:outline-none" placeholder="you@example.com"/>
                </div>
                <div>
                  <label for="signin-password" class="block text-sm font-medium mb-1">Password</label>
                  <input id="signin-password" type="password" required class="w-full px-3 py-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:outline-none" placeholder="â¢â¢â¢â¢â¢â¢â¢â¢"/>
                </div>
                <p id="signin-error" class="text-red-600 text-sm hidden">Invalid email or password.</p>
                <p id="signin-success" class="text-green-600 text-sm hidden">Login successful!</p>
                <button id="signin-submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 disabled:opacity-50">Sign In</button>
              </form>
            </div>
          </div>`;

          const m = tpl.content.cloneNode(true);
          document.body.append(m);

          const form    = document.getElementById('signin-form');
          const emailIn = document.getElementById('signin-email');
          const passIn  = document.getElementById('signin-password');
          const err     = document.getElementById('signin-error');
          const ok      = document.getElementById('signin-success');
          const submit  = document.getElementById('signin-submit');
          const loader  = document.getElementById('signin-loading');

          document.getElementById('close-signin')?.addEventListener('click', () => m.children[0].remove());
          m.children[0].addEventListener('click', e => {
            if (e.target === m.children[0]) m.children[0].remove();
          });

          if (form) {
            form.addEventListener('submit', e => {
              e.preventDefault();
              err.classList.add('hidden');
              ok.classList.add('hidden');
              submit.disabled = true;
              loader.classList.remove('hidden');

              fetch(AUTH_API)
                .then(r => r.json())
                .then(users => {
                  const u = users.find(u =>
                    u.Email === emailIn.value.trim() && u.Password === passIn.value
                  );
                  if (!u) {
                    err.classList.remove('hidden');
                    submit.disabled = false;
                    loader.classList.add('hidden');
                    return;
                  }
                  ok.classList.remove('hidden');
                  setTimeout(() => {
                    m.children[0].remove();
                    initAuth(u);
                  }, 500);
                })
                .catch(() => {
                  err.textContent = 'Network error';
                  err.classList.remove('hidden');
                })
                .finally(() => {
                  submit.disabled = false;
                  loader.classList.add('hidden');
                });
            });
          }
        });
      }
    }); // end DOMContentLoaded

    // âââââââ Respond to Back/Forward browser navigation âââââââ
    window.addEventListener('popstate', () => {
      const slug = location.hash.slice(1);
      if (slug && itemMap[slug]) {
        showDetails(itemMap[slug], slug);
      } else {
        document.getElementById('main').innerHTML = '<main id="content" class="max-w-7xl mx-auto px-4 py-6"></main>';
        fetchAndRenderItems();
      }
    });

    // âââââââ Apply any hrefs we loaded from LINK_API âââââââ
    function applyLinks() {
      Object.entries(linkMap).forEach(([key, url]) => {
        document.querySelectorAll(`a[data-key="${key}"]`).forEach(a => a.href = url);
      });
    }

    // âââââââ After a successful sign-in, swap in the userâs profile picture, etc. âââââââ
    function initAuth(u) {
      window.currentUser = u;
      localStorage.setItem('currentUser', JSON.stringify(u));
      const ac = document.getElementById('authContainer');
      if (ac) {
        ac.innerHTML = `
          <a data-key="Upload Activity" href="#" class="text-gray-600 dark:text-gray-300 mr-4 cursor-pointer">
            <i class="fas fa-plus-circle fa-lg"></i>
          </a>
          <i class="fas fa-bell text-gray-600 dark:text-gray-300 mr-4 cursor-pointer"></i>
          <span class="font-medium mr-2">${u["First Name"]}</span>
        `;
      }
      const pfc = document.createElement('div');
      pfc.id = 'pfpContainer';
      pfc.className = 'relative';
      let pfpBtn;
      if (u["Profile Picture"]) {
        pfpBtn = document.createElement('img');
        pfpBtn.id = 'pfpBtn';
        pfpBtn.src = u["Profile Picture"];
        pfpBtn.className = 'h-10 w-10 rounded-full border-2 border-gray-200 dark:border-gray-700 cursor-pointer';
      } else {
        pfpBtn = document.createElement('div');
        pfpBtn.id = 'pfpBtn';
        pfpBtn.className = 'h-10 w-10 rounded-full border-2 border-gray-200 dark:border-gray-700 cursor-pointer flex items-center justify-center text-white font-medium';
        const hue = Math.floor(Math.random() * 360);
        pfpBtn.style.backgroundColor = `hsl(${hue}, 70%, 40%)`;
        const initials = ((u["First Name"]||'')[0]||'') + ((u["Last Name"]||'')[0]||'');
        pfpBtn.textContent = initials.toUpperCase();
      }
      pfc.appendChild(pfpBtn);
      ac?.appendChild(pfc);

      applyLinks();

      const ddClone = document.getElementById('profile-dropdown-template').content.cloneNode(true);
      pfc.append(ddClone);

      const dd = document.getElementById('profileDropdown');
      document.getElementById('pfpBtn')?.addEventListener('click', e => {
        e.stopPropagation();
        dd.classList.toggle('hidden');
      });
      document.addEventListener('click', () => dd.classList.add('hidden'));

      document.getElementById('logoutBtn')?.addEventListener('click', e => {
        e.preventDefault();
        showLogoutConfirmation();
      });
    }

    // âââââââ Show a âconfirm logoutâ modal âââââââ
    function showLogoutConfirmation() {
      const tpl = document.createElement('template');
      tpl.innerHTML = `
      <div class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-80">
          <h3 class="text-lg font-semibold mb-4">Confirm Logout</h3>
          <p class="text-sm text-gray-700 dark:text-gray-300">Are you sure you want to log out?</p>
          <div class="mt-6 flex justify-end space-x-2">
            <button id="logout-confirm-cancel" class="px-4 py-2 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200">Cancel</button>
            <button id="logout-confirm-yes" class="px-4 py-2 rounded bg-red-600 hover:bg-red-700 text-white">Log Out</button>
          </div>
        </div>
      </div>`;
      const modal = tpl.content.cloneNode(true);
      document.body.append(modal);

      document.getElementById('logout-confirm-cancel')?.addEventListener('click', () => modal.children[0].remove());
      document.getElementById('logout-confirm-yes')?.addEventListener('click', () => {
        localStorage.removeItem('currentUser');
        location.reload();
      });
    }
  </script>

  <!-- ========== PROFILE-DROPDOWN TEMPLATE ========== -->
  <template id="profile-dropdown-template">
    <div id="profileDropdown" class="absolute right-0 mt-2 w-40 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded shadow-lg py-2 z-50 hidden">
      <a data-key="Profile" href="#" class="block px-4 py-2 text-sm flex items-center hover:bg-gray-100 dark:hover:bg-gray-700">
        <i class="fas fa-user mr-2"></i>Profile
      </a>
      <a data-key="Settings" href="#" class="block px-4 py-2 text-sm flex items-center hover:bg-gray-100 dark:hover:bg-gray-700">
        <i class="fas fa-cog mr-2"></i>Settings
      </a>
      <a data-key="My Activities" href="#" class="block px-4 py-2 text-sm flex items-center hover:bg-gray-100 dark:hover:bg-gray-700">
        <i class="fas fa-list mr-2"></i>My Activities
      </a>
      <a id="logoutBtn" href="#" class="block px-4 py-2 text-sm flex items-center hover:bg-gray-100 dark:hover:bg-gray-700">
        <i class="fas fa-sign-out-alt mr-2"></i>Logout
      </a>
    </div>
  </template>
</body>
</html>
